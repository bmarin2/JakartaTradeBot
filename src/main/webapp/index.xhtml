<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui">
	<h:head>
		<title>Index</title>
		<style>
			.ui-widget {
				font-size: 13px !important;
			}

			.ui-panelgrid-cell {
				padding: 3px !important;
			}

			.center-it{
				display: flex;
				align-items: center;
				justify-content: center;
			}

			.ui-card {
				border: 1px solid !important;
				border-color: darkgray !important;
			}

		</style>

	</h:head>
	<h:body>

		<p:growl id="growl" showDetail="true" />

		<div style="margin:0 auto;width:70%;">            
			<h:form id="headerForm">
				<p:commandButton value="Create Bot" styleClass="ui-button-success" icon="pi pi-plus-circle"
							  oncomplete="PF('manageBot').show()" action="#{indexView.newBot()}" update="manageBotForm">
					<p:resetInput target="manageBotForm:manage-bot" />
				</p:commandButton>                
				<p:outputLabel id="numberId" value="Number of running tasks: #{indexView.getRunningTasksNumber()}" style="float:right;padding-top:10px"/>
				<hr style="margin-bottom:10px;margin-top:15px"></hr>
			</h:form>

			<h:form id="botListForm">
				<p:repeat value="#{indexView.bots}" var="bot">
					<p:card style="margin:.5em;display:inline-block;border-color:background;background-color:#F0F0F0;padding:0;width:32%;">
						<f:facet name="title" >
							<span style="margin-top: -5px">#{bot.symbol}</span>
							<p:tag styleClass="mr-2" severity="success" rounded="true" icon="pi pi-check" style="float:right" value="Running" rendered="#{indexView.isBotRunning(bot.taskId)}"/>
							<p:tag styleClass="mr-2" severity="warning" rounded="true" icon="pi pi-times-circle" style="float:right" value="Stopped" rendered="#{!indexView.isBotRunning(bot.taskId)}"/>
						</f:facet>

						<f:facet name="subtitle">
							#{bot.taskId}
						</f:facet>

						<f:facet name="footer">
							<p:commandButton icon="pi pi-list" value="Details" oncomplete="PF('botDetails').show()" update="detailsForm" style="margin-right:5px;">
								<f:setPropertyActionListener value="#{bot}" target="#{indexView.selectedTradeBot}" />
							</p:commandButton>

							<p:commandButton icon="pi pi-file" value="Edit" oncomplete="PF('manageBot').show()" update="manageBotForm" disabled="#{indexView.isBotRunning(bot.taskId)}" action="#{indexView.editBot()}">
								<f:setPropertyActionListener value="#{bot}" target="#{indexView.selectedTradeBot}" />
							</p:commandButton>
						</f:facet>
					</p:card>
				</p:repeat>
			</h:form>    

			<h:form id="manageBotForm">
				<p:dialog widgetVar="manageBot" height="250" width="40%" showEffect="fade" modal="true">
					<f:facet name="header">
						<h:outputText id="outputId" value="#{indexView.shouldEditBot ? 'Edit Bot' : 'Create New Bot'}" />
					</f:facet>
					<p:panelGrid id="manage-bot" columns="4" style="width: 100%" styleClass="ui-noborder center-it">
						<p:outputLabel for="input1" value="Symbol"/>
						<p:inputText id="input1" value="#{indexView.selectedTradeBot.symbol}" />

						<p:outputLabel for="select2" value="Time Unit"/>
						<p:selectOneMenu value="#{indexView.selectedTradeBot.timeUnit}" id="select2" style="width:100%">
							<f:selectItems value="#{indexView.units}" var="unit" itemLabel="#{unit}" itemValue="#{unit}"/>
						</p:selectOneMenu>

						<p:outputLabel for="input4" value="TaskId"/>
						<p:inputText id="input4" value="#{indexView.selectedTradeBot.taskId}"/>

						<p:outputLabel for="input2" value="Initial Delay"/>
						<p:inputText id="input2" value="#{indexView.selectedTradeBot.initialDelay}" />

						<p:outputLabel for="input3" value="Delay"/>
						<p:inputText id="input3" value="#{indexView.selectedTradeBot.delay}" />

						<p:outputLabel for="input5" value="Quote Order Qty"/>
						<p:inputText id="input5" value="#{indexView.selectedTradeBot.quoteOrderQty}"/>

						<p:outputLabel for="input6" value="Max Orders per Cycle"/>
						<p:inputText id="input6" value="#{indexView.selectedTradeBot.cycleMaxOrders}"/>

						<p:outputLabel for="input7" value="Order Step in %"/>
						<p:inputText id="input7" value="#{indexView.selectedTradeBot.orderStep}"/>

						<p:outputLabel for="input8" value="Date Created"/>
						<p:datePicker id="input8" showTime="true" value="#{indexView.selectedTradeBot.createdDate}" />

						<p:outputLabel for="input9" value="Description"/>
						<p:inputTextarea id="input9" rows="4" cols="22" autoResize="false" value="#{indexView.selectedTradeBot.description}" />
					</p:panelGrid>
					<f:facet name="footer">
						<div style="padding-top:15px;">
							<p:commandButton value="Save" icon="pi pi-check" action="#{indexView.updateBot}" update="growl botListForm" />
							<p:commandButton value="Cancel" icon="pi pi-times" onclick="PF('manageBot').hide()"
										  class="ui-button-secondary" type="button" />
						</div>
					</f:facet>
				</p:dialog>
			</h:form>

			<h:form id="detailsForm">
				<p:dialog closable="false" widgetVar="botDetails" height="250" width="40%" showEffect="fade" modal="true" >
					<f:facet name="header">
						#{indexView.selectedTradeBot.symbol}
						<h:outputText id="txtId" value="#{indexView.isBotRunning(indexView.selectedTradeBot.taskId) ? '(Running)' : '(Stopped)'}" />
					</f:facet>
					<p:panelGrid columns="2" style="display:inline-block;margin-right:10px;">
						<h:outputText value="Symbol"/>
						<h:outputText value="#{indexView.selectedTradeBot.symbol}"/>
						<h:outputText value="TaskId"/>
						<h:outputText value="#{indexView.selectedTradeBot.taskId}"/>
						<h:outputText value="Description"/>
						<h:outputText value="#{indexView.selectedTradeBot.description}"/>
						
						<h:outputText value="QuoteOrderQty"/>
						<h:outputText value="#{indexView.selectedTradeBot.quoteOrderQty}"/>
						<h:outputText value="CycleMaxOrders"/>
						<h:outputText value="#{indexView.selectedTradeBot.cycleMaxOrders}"/>
					</p:panelGrid>
					<p:panelGrid columns="2" style="display:inline-block">
						<h:outputText value="Order Step"/>
						<h:outputText value="#{indexView.selectedTradeBot.orderStep}"/>
						
						<h:outputText value="Initial Delay"/>
						<h:outputText value="#{indexView.selectedTradeBot.initialDelay}"/>
						<h:outputText value="Delay"/>
						<h:outputText value="#{indexView.selectedTradeBot.delay}"/>
						<h:outputText value="Time Unit"/>
						<h:outputText value="#{indexView.selectedTradeBot.timeUnit}"/>						

						<h:outputText value="Created Date"/>						
						<h:outputText value="#{indexView.selectedTradeBot.createdDate}" >
							<f:convertDateTime type="localDateTime" pattern="dd.MM.yyyy HH:mm" />
						</h:outputText>
						
						
					</p:panelGrid>
					<f:facet name="footer">
						<div style="padding-top:15px;">
							<p:commandButton id="runId" update="txtId runId stopId growl headerForm:numberId botListForm" value="Run Bot" styleClass="ui-button-success" action="#{indexView.addTask}" style="float:left"
										  disabled="#{indexView.isBotRunning(indexView.selectedTradeBot.taskId)}" />
							<p:commandButton id="stopId" update="txtId stopId runId growl headerForm:numberId botListForm" value="Stop Bot" styleClass="ui-button-warning" action="#{indexView.removeTask}" style="float:left"
										  disabled="#{not indexView.isBotRunning(indexView.selectedTradeBot.taskId)}" />
							<p:commandButton value="Close" styleClass="ui-button-secondary" onclick="PF('botDetails').hide()"
										  class="ui-button-secondary" type="button" />
						</div>
					</f:facet>
				</p:dialog>
			</h:form>
		</div>
	</h:body>
</html>
